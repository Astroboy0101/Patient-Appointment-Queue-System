{% extends "base.html" %}
{% block title %}My Appointments - CareFirst Hospital{% endblock %}

{% block content %}
<section class="dashboard-section">
    <h2>My Appointments</h2>
    {% if error %}
        <div class="flash error">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div class="flash success">Appointment added successfully.</div>
    {% endif %}

    <form class="search-bar-form" method="get" action="{{ url_for('patient_dashboard') }}">
        <input type="search" name="q" value="{{ search_q }}" placeholder="Search by name, date, time, or priority...">
        <button type="submit">Search</button>
    </form>

    {% if appointments %}
        <div class="queue-table-wrap">
            <table class="queue-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Patient name</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Priority</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in appointments %}
                    <tr class="priority-{{ a.priority }}">
                        <td>{{ loop.index }}</td>
                        <td>{{ a.name }}</td>
                        <td>{{ a.appointment_date }}</td>
                        <td>{{ a.appointment_time }}</td>
                        <td><span class="badge badge-{{ a.priority }}">{{ a.priority }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="empty-queue">No appointments found.{% if search_q %} Try a different search.{% endif %}</p>
    {% endif %}

    <div class="add-appointment-section">
        <h3>Add appointment</h3>
        <p class="add-hint">Add a new appointment if your name is not in the table above.</p>
        <form class="patient-form add-form" method="post" action="{{ url_for('patient_dashboard') }}">
            <input type="hidden" name="action" value="add">
            <label for="patient_name">Patient name *</label>
            <input type="text" id="patient_name" name="patient_name" value="{{ session.get('full_name') or '' }}" required placeholder="Full name">
            <label for="appointment_date">Date *</label>
            <input type="date" id="appointment_date" name="appointment_date" required>
            <label for="appointment_time">Time *</label>
            <input type="time" id="appointment_time" name="appointment_time" required>
            <label for="priority">Priority</label>
            <select id="priority" name="priority">
                {% for p in priorities %}
                    <option value="{{ p }}">{{ p|capitalize }}</option>
                {% endfor %}
            </select>
            <button type="submit">Add appointment</button>
        </form>
    </div>
</section>
{% endblock %}
